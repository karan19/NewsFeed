# NewsFeed Project - Cursor Rules

## Project Overview
This is a newsfeed application that consolidates data from multiple DynamoDB tables into a unified table using AWS Lambda and DynamoDB Streams.

## Tech Stack
- **Infrastructure**: AWS CDK (TypeScript)
- **Lambda Runtime**: Node.js with TypeScript
- **Database**: Amazon DynamoDB
- **Cloud Provider**: AWS

## Code Style & Conventions

### TypeScript
- Use strict TypeScript (`strict: true` in tsconfig)
- Prefer `interface` over `type` for object shapes
- Use explicit return types on functions
- Use `const` by default, `let` only when reassignment is needed
- Never use `any` - use `unknown` and type guards instead
- Use async/await over raw Promises

### Naming Conventions
- **Files**: kebab-case (e.g., `stream-handler.ts`, `unified-table.ts`)
- **Classes**: PascalCase (e.g., `NewsFeedStack`, `StreamProcessor`)
- **Functions/Variables**: camelCase (e.g., `processStreamEvent`, `tableArn`)
- **Constants**: SCREAMING_SNAKE_CASE (e.g., `MAX_BATCH_SIZE`, `TABLE_NAME`)
- **Interfaces**: PascalCase with `I` prefix optional (e.g., `UnifiedRecord` or `IUnifiedRecord`)

### CDK Conventions
- One stack per file in `lib/` directory
- Use constructs for reusable components
- Always add descriptions to CloudFormation resources
- Use environment variables for configuration, not hardcoded values
- Tag all resources with:
  - `Project: NewsFeed`
  - `Environment: Production`

### Lambda Conventions
- Each Lambda function in its own directory under `src/lambdas/`
- Shared utilities in `src/shared/`
- Keep handlers thin - business logic in separate modules
- Always handle DynamoDB Stream event types: INSERT, MODIFY, REMOVE
- Implement idempotent operations
- Use structured logging (JSON format)
- Include correlation IDs in logs

### DynamoDB Conventions
- Unified table primary key format: `{TABLE_NAME}#{record_id}`
- Always include `source_type`, `table_name`, `original_id` fields
- Use ISO 8601 format for timestamps
- Soft delete with `is_deleted` flag when mirroring REMOVE events

### Error Handling
- Use custom error classes for domain errors
- Always log errors with context before rethrowing
- Lambda should fail loudly (throw) to trigger DLQ/retry
- Validate input at Lambda handler entry point

### Testing
- Unit tests alongside source files (`*.test.ts`)
- Integration tests in `test/integration/`
- Use Jest as the test framework
- Mock AWS SDK calls in unit tests

### Git Conventions
- Conventional commits: `feat:`, `fix:`, `chore:`, `docs:`, `refactor:`
- Keep commits atomic and focused
- Branch naming: `feature/`, `fix/`, `chore/`

## Project Structure
```
NewsFeed/
├── bin/                    # CDK app entry point
├── lib/                    # CDK stacks and constructs
├── src/
│   ├── lambdas/           # Lambda function handlers
│   │   └── {function}/    # Each Lambda in its own folder
│   └── shared/            # Shared utilities and types
├── test/                  # Test files
├── cdk.json               # CDK configuration
├── tsconfig.json          # TypeScript configuration
└── package.json           # Dependencies
```

## AWS Resources Naming (Ada_Case)
- Stack: `NewsFeed-Stack` (CloudFormation requires hyphens, not underscores)
- Lambda: `NewsFeed_{Function_Name}` (e.g., `NewsFeed_Notes_Processor`)
- DynamoDB Table: `NewsFeed_Unified_Table`
- DynamoDB GSI: `GSI{N}_{Description}` (e.g., `GSI1_Source_Type_Created_At`)
- IAM Roles: Auto-generated by CDK with stack prefix

## Resource Tags
All resources are tagged with:
- `Project: NewsFeed`
- `Environment: Production`

